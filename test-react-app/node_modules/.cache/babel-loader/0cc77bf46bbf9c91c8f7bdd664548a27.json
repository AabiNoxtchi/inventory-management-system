{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"D:\\\\Uni-2020\\\\Java\\\\imy-project\\\\inventory-management-system\\\\test-react-app\\\\src\\\\component\\\\EventListner.jsx\",\n    _s = $RefreshSig$();\n\nimport { EventSourcePolyfill } from 'event-source-polyfill';\nimport authHeader from '../service/AuthHeader';\nimport React, { useEffect, useState } from 'react';\nimport { ToastContainer, toast } from 'react-toastify';\nimport { Link, withRouter } from 'react-router-dom';\n\nfunction EventListner() {\n  _s();\n\n  const [listening, setListening] = useState(false);\n  const [data, setData] = useState([]);\n  let eventSource = undefined;\n\n  const ToastWithLink = (title, msg, link) => /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(Link, {\n      to: link,\n      children: msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 12\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 14,\n    columnNumber: 11\n  }, this);\n\n  const getListString = list => {\n    let str = list.toString();\n    str = str.substring(1, str.length - 1);\n    return str;\n  };\n\n  useEffect(() => {\n    if (!listening) {\n      var EventSource = EventSourcePolyfill;\n      eventSource = new EventSource(\"http://localhost:8080/api/inventory/manager/subscribeWebClient\", {\n        headers: authHeader()\n      });\n\n      eventSource.onopen = event => {\n        console.log(\"connection opened event = \" + JSON.stringify(event)); //console.log(\"connection opened event.target = \" + JSON.stringify(event.target))\n      };\n\n      eventSource.onmessage = event => {\n        // console.log(\"result = \", event.data);\n        console.log(\"result event = \", JSON.stringify(event)); // console.log(\"result event.target = \", JSON.stringify(event.target));\n\n        toast(event.data, {\n          position: \"bottom-right\",\n          hideProgressBar: true\n        }); // setData(old => [...old, event.data])\n      };\n      /* eventSource.onkeepalive = (event) => {\r\n           console.log(\"result = \", event.data);\r\n           //console.log(\"result event = \", JSON.stringify(event));\r\n         //  console.log(\"result event.target = \", JSON.stringify(event.target));\r\n           toast(event.data, { position: \"bottom-right\", hideProgressBar: true });\r\n           // setData(old => [...old, event.data])\r\n       }*/\n      //keep alive pings\n\n\n      eventSource.addEventListener(\"keepalive\", event => {\n        console.log(\"show data = \" + event.data); //(JSON.stringify(event.data)))\n        //toast(event.data, { position: \"bottom-right\", hideProgressBar: true });\n      }); //Amortized\n\n      eventSource.addEventListener(\"amortized\", event => {\n        console.log(\"show data = \" + event.data); //(JSON.stringify(event.data)))\n\n        toast(ToastWithLink(\"Amortization\", \"fully amortized inventories\", \"/productdetails?Filter.ids=\" + getListString(event.data)), {\n          position: \"bottom-right\",\n          autoClose: false\n        });\n      }); //AllDiscarded\n\n      eventSource.addEventListener(\"alldiscarded\", event => {\n        // console.log(\"show data = \" + event.data);//(JSON.stringify(event.data)))\n        toast(ToastWithLink(\"Deliveries\", \"all discarded deliveries\", \"/deliveries?Filter.ids=\" + getListString(event.data)), {\n          position: \"bottom-right\",\n          autoClose: false\n        });\n      }); //EmptyDeliveries\n\n      eventSource.addEventListener(\"emptydeliveries\", event => {\n        // console.log(\"show data = \" + event.data);//(JSON.stringify(event.data)))\n        toast(ToastWithLink(\"Deliveries\", \"empty deliveries\", \"/deliveries?Filter.ids=\" + getListString(event.data)), {\n          position: \"bottom-right\",\n          autoClose: false\n        });\n      });\n\n      eventSource.onerror = event => {\n        // console.log(\"event error = \"+JSON.stringify(event))\n        console.log(\"error : error state = \" + event.target.readyState);\n\n        if (event.target.readyState === EventSource.CLOSED) {\n          console.log('eventsource not closed (' + event.target.readyState + ')');\n        } //eventSource.close();\n\n      };\n\n      setListening(true);\n    }\n\n    return () => {\n      eventSource.close();\n      console.log(\"eventsource closed\");\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n  {\n    /* <div >\r\n         <AppInstructor/>\r\n     </div>*/\n  } //);\n}\n\n_s(EventListner, \"pPhG6bgkdMd/wcIrmeoar7uJYNI=\");\n\n_c = EventListner;\nexport default EventListner;\n\nvar _c;\n\n$RefreshReg$(_c, \"EventListner\");","map":{"version":3,"sources":["D:/Uni-2020/Java/imy-project/inventory-management-system/test-react-app/src/component/EventListner.jsx"],"names":["EventSourcePolyfill","authHeader","React","useEffect","useState","ToastContainer","toast","Link","withRouter","EventListner","listening","setListening","data","setData","eventSource","undefined","ToastWithLink","title","msg","link","getListString","list","str","toString","substring","length","EventSource","headers","onopen","event","console","log","JSON","stringify","onmessage","position","hideProgressBar","addEventListener","autoClose","onerror","target","readyState","CLOSED","close"],"mappings":"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","sourcesContent":["import { EventSourcePolyfill } from 'event-source-polyfill';\r\nimport authHeader from '../service/AuthHeader';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport { Link, withRouter } from 'react-router-dom'\r\n\r\nfunction EventListner() {\r\n   \r\n    const [listening, setListening] = useState(false);\r\n    const [data, setData] = useState([]);\r\n    let eventSource = undefined;\r\n\r\n      const ToastWithLink = (title, msg, link) => (\r\n          <div>\r\n              <h5>{title}</h5>\r\n           <Link to={link}>{msg}</Link>\r\n        </div>\r\n    );\r\n\r\n    const getListString = (list) => {\r\n        let str = list.toString();\r\n        str = str.substring(1, str.length - 1)\r\n        return str\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!listening) {\r\n            var EventSource = EventSourcePolyfill; \r\n            eventSource = new EventSource(\"http://localhost:8080/api/inventory/manager/subscribeWebClient\", { headers: authHeader() });\r\n\r\n            eventSource.onopen = (event) => {\r\n                console.log(\"connection opened event = \" + JSON.stringify(event))\r\n                //console.log(\"connection opened event.target = \" + JSON.stringify(event.target))\r\n            }\r\n\r\n            eventSource.onmessage = (event) => {\r\n               // console.log(\"result = \", event.data);\r\n                console.log(\"result event = \", JSON.stringify(event));\r\n               // console.log(\"result event.target = \", JSON.stringify(event.target));\r\n                toast(event.data, { position: \"bottom-right\", hideProgressBar: true });\r\n               // setData(old => [...old, event.data])\r\n            }\r\n\r\n           /* eventSource.onkeepalive = (event) => {\r\n                console.log(\"result = \", event.data);\r\n                //console.log(\"result event = \", JSON.stringify(event));\r\n              //  console.log(\"result event.target = \", JSON.stringify(event.target));\r\n                toast(event.data, { position: \"bottom-right\", hideProgressBar: true });\r\n                // setData(old => [...old, event.data])\r\n            }*/\r\n\r\n            //keep alive pings\r\n            eventSource.addEventListener(\"keepalive\", (event) => {\r\n                console.log(\"show data = \"+event.data)//(JSON.stringify(event.data)))\r\n                //toast(event.data, { position: \"bottom-right\", hideProgressBar: true });\r\n            })\r\n\r\n\r\n            //Amortized\r\n            eventSource.addEventListener(\"amortized\", (event) => {\r\n                console.log(\"show data = \" + event.data);//(JSON.stringify(event.data)))\r\n                toast(ToastWithLink(\"Amortization\", \"fully amortized inventories\", \"/productdetails?Filter.ids=\" + getListString(event.data)), { position: \"bottom-right\", autoClose: false });\r\n            })\r\n\r\n            //AllDiscarded\r\n            eventSource.addEventListener(\"alldiscarded\", (event) => {\r\n               // console.log(\"show data = \" + event.data);//(JSON.stringify(event.data)))\r\n                toast(ToastWithLink(\"Deliveries\", \"all discarded deliveries\", \"/deliveries?Filter.ids=\" + getListString(event.data)), { position: \"bottom-right\", autoClose: false });\r\n            })\r\n\r\n            //EmptyDeliveries\r\n            eventSource.addEventListener(\"emptydeliveries\", (event) => {\r\n                // console.log(\"show data = \" + event.data);//(JSON.stringify(event.data)))\r\n                toast(ToastWithLink(\"Deliveries\", \"empty deliveries\", \"/deliveries?Filter.ids=\" + getListString(event.data)), { position: \"bottom-right\", autoClose: false });\r\n            })\r\n\r\n            eventSource.onerror = (event) => {\r\n               // console.log(\"event error = \"+JSON.stringify(event))\r\n                console.log(\"error : error state = \"+event.target.readyState)\r\n                if (event.target.readyState === EventSource.CLOSED) {\r\n                    console.log('eventsource not closed (' + event.target.readyState + ')')\r\n                }\r\n                //eventSource.close();\r\n            }\r\n\r\n           \r\n\r\n           \r\n\r\n            setListening(true);\r\n        }\r\n\r\n        return () => {\r\n            eventSource.close();\r\n            console.log(\"eventsource closed\")\r\n        }\r\n\r\n    }, [])\r\n\r\n  \r\n\r\n    return (\r\n        <></>\r\n    );\r\n\r\n    {/* <div >\r\n          <AppInstructor/>\r\n      </div>*/}\r\n    //);\r\n}\r\n\r\nexport default EventListner;\r\n"]},"metadata":{},"sourceType":"module"}